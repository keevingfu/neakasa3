<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neakasa Analytics Dashboard</title>
    <!-- Primary Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Backup Chart.js CDN -->
    <script>
        if (typeof Chart === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"><\/script>');
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        .chart-container { position: relative; height: 300px; width: 100%; }
        .chart-container.large { height: 400px; }
        .chart-container.xl { height: 500px; }
        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Fallback spinner animation for older browsers */
        .spinner {
            -webkit-animation: spin 1s linear infinite;
            -moz-animation: spin 1s linear infinite;
            -o-animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        /* Sidebar and navigation styles */
        .nav-category-header {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            padding: 0 16px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .chart-container { height: 250px; }
        }
        /* Insights section styles */
        .insights-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }
        .recommendation-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .recommendation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        /* YoY/MoM comparison styles */
        .comparison-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .comparison-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
        }
        .trend-up {
            background-color: #d1fae5;
            color: #065f46;
        }
        .trend-down {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .trend-neutral {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .metric-comparison {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin: 8px 0;
        }
        .metric-comparison .current {
            font-size: 24px;
            font-weight: 700;
        }
        .metric-comparison .previous {
            font-size: 14px;
            color: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Loading Dashboard...</p>
            <p class="text-sm text-gray-500 mt-2">Please wait...</p>
        </div>
    </div>

    <div class="flex h-screen" id="mainApp" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar w-64 bg-slate-800 text-white overflow-y-auto">
            <div class="p-6 border-b border-slate-700">
                <h2 class="text-xl font-semibold">📊 Neakasa Analytics</h2>
                <p class="text-sm text-slate-400 mt-1">ROI 6.97x · Zero Marketing</p>
            </div>
            <nav id="navigation" class="p-4"></nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            <div class="bg-white shadow-sm px-8 py-4 flex justify-between items-center">
                <h1 id="pageTitle" class="text-2xl font-bold text-gray-800"></h1>
                <div class="flex gap-3">
                    <select id="dateRange" class="px-4 py-2 border rounded hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="weekly">Weekly</option>
                        <option value="current">Current Week</option>
                        <option value="monthly">This Month</option>
                    </select>
                    <button onclick="window.dashboardApp && window.dashboardApp.refresh()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">
                        Refresh
                    </button>
                </div>
            </div>
            <div id="dashboard" class="p-8"></div>
        </div>
    </div>

    <script>
        // Global Chart.js check and initialization
        window.chartJsLoaded = false;
        
        // Check if Chart.js is loaded
        function checkChartJS(callback, attempts = 0) {
            if (typeof Chart !== 'undefined' && Chart.version) {
                console.log('Chart.js version ' + Chart.version + ' loaded successfully');
                window.chartJsLoaded = true;
                callback();
            } else if (attempts < 20) {
                console.log(`Waiting for Chart.js... (attempt ${attempts + 1})`);
                setTimeout(() => checkChartJS(callback, attempts + 1), 200);
            } else {
                console.warn('Chart.js failed to load, continuing without charts');
                window.NO_CHARTS = true;
                callback();
            }
        }

        // Dashboard Configuration
        const DASHBOARD_CONFIG = {
            yoyAnalysis: {
                title: 'Performance Analytics - YoY/MoM Comparison Dashboard',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { 
                                label: 'Total Revenue (June)', 
                                value: '$26,587', 
                                trend: '↑', 
                                change: '+127% MoM', 
                                color: '#10B981',
                                comparison: { current: '$26,587', previous: 'May: $11,720' }
                            },
                            { 
                                label: 'Order Volume (June)', 
                                value: '132', 
                                trend: '↑', 
                                change: '+89% MoM', 
                                color: '#10B981',
                                comparison: { current: '132', previous: 'May: 70' }
                            },
                            { 
                                label: 'Avg Conversion Rate', 
                                value: '0.48%', 
                                trend: '↑', 
                                change: '+0.33pp WoW', 
                                color: '#10B981',
                                comparison: { current: '0.48%', previous: 'Last Week: 0.15%' }
                            },
                            { 
                                label: 'Channel Efficiency', 
                                value: '3.2x', 
                                trend: '↑', 
                                change: '+23% WoW', 
                                color: '#10B981',
                                comparison: { current: '3.2x', previous: 'Last Week: 2.6x' }
                            }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'weeklyTrendChart',
                                type: 'line',
                                title: 'Weekly Performance Trend (8-Week View)',
                                data: {
                                    labels: ['W19 (May 7-11)', 'W20 (May 12-18)', 'W21 (May 19-25)', 'W22 (May 26-Jun 1)', 'W23 (Jun 2-8)', 'W24 (Jun 9-15)', 'W25 (Jun 16-22)', 'W26 (Jun 23-29)'],
                                    datasets: [
                                        {
                                            label: 'Revenue ($)',
                                            data: [2233, 3371, 2540, 3145, 4229, 3584, 3991, 4536],
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                            yAxisID: 'y',
                                            tension: 0.4,
                                            fill: true
                                        },
                                        {
                                            label: 'Orders',
                                            data: [14, 26, 18, 22, 28, 25, 30, 35],
                                            borderColor: '#10B981',
                                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                            yAxisID: 'y1',
                                            tension: 0.4,
                                            fill: true
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'productGrowthChart',
                                type: 'bar',
                                title: 'Product Performance MoM Growth Rate (%)',
                                data: {
                                    labels: ['M1 Litter Box', 'Steamer', 'P1'],
                                    datasets: [
                                        {
                                            label: 'May to June Growth %',
                                            data: [112, 168, 100],
                                            backgroundColor: function(context) {
                                                const value = context.raw;
                                                if (value >= 150) return '#10B981';
                                                if (value >= 100) return '#3B82F6';
                                                if (value >= 50) return '#F59E0B';
                                                return '#EF4444';
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'comparison-grid',
                        title: 'Multi-Dimensional Performance Analysis',
                        cards: [
                            {
                                title: 'Time Dimension Analysis',
                                metrics: [
                                    { label: 'Best Week', value: 'Jun 23-29', change: '+39% vs Avg' },
                                    { label: 'Worst Week', value: 'May 7-11', change: '-42% vs Avg' },
                                    { label: 'Growth Acceleration', value: '+12% Weekly', change: 'Compound' }
                                ]
                            },
                            {
                                title: 'Product Dimension Analysis',
                                metrics: [
                                    { label: 'Top Performer', value: 'M1 ($440 AOV)', change: '+57% vs Others' },
                                    { label: 'Volume Leader', value: 'Steamer (58 orders)', change: '38% of Total' },
                                    { label: 'New Entry', value: 'P1 (Testing)', change: 'First Sale' }
                                ]
                            },
                            {
                                title: 'Channel Dimension Analysis',
                                metrics: [
                                    { label: 'Revenue Leader', value: 'Website (69%)', change: 'Stable' },
                                    { label: 'Growth Channel', value: 'Amazon (29%)', change: '+89% MoM' },
                                    { label: 'Emerging', value: 'TikTok Shop', change: 'Testing Phase' }
                                ]
                            },
                            {
                                title: 'KPI Dimension Analysis',
                                metrics: [
                                    { label: 'Best CVR', value: 'YouTube (3.2%)', change: '20x Average' },
                                    { label: 'Highest AOV', value: 'Website ($402)', change: '2.3x Others' },
                                    { label: 'ROI Champion', value: 'Instagram', change: '6.97x Return' }
                                ]
                            }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'channelComparisonChart',
                                type: 'radar',
                                title: 'Channel Performance Index (Normalized 0-100)',
                                data: {
                                    labels: ['Traffic Volume', 'Conversion Rate', 'Revenue Share', 'AOV Index', 'Growth Rate', 'Efficiency Score'],
                                    datasets: [
                                        {
                                            label: 'Website',
                                            data: [45, 85, 69, 100, 60, 95],
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.2)'
                                        },
                                        {
                                            label: 'Amazon',
                                            data: [80, 65, 29, 43, 89, 75],
                                            borderColor: '#10B981',
                                            backgroundColor: 'rgba(16, 185, 129, 0.2)'
                                        },
                                        {
                                            label: 'TikTok Shop',
                                            data: [30, 40, 2, 24, 100, 45],
                                            borderColor: '#EC4899',
                                            backgroundColor: 'rgba(236, 72, 153, 0.2)'
                                        },
                                        {
                                            label: 'Social Links',
                                            data: [20, 5, 1, 14, 20, 10],
                                            borderColor: '#F59E0B',
                                            backgroundColor: 'rgba(245, 158, 11, 0.2)'
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'conversionFunnelComparison',
                                type: 'bar',
                                title: 'Conversion Funnel by Time Period',
                                data: {
                                    labels: ['Total Clicks', 'Product Views', 'Add to Cart', 'Checkout', 'Orders'],
                                    datasets: [
                                        {
                                            label: 'May Average',
                                            data: [12500, 6250, 312, 88, 18],
                                            backgroundColor: 'rgba(107, 114, 128, 0.5)'
                                        },
                                        {
                                            label: 'June Average',
                                            data: [15800, 9480, 632, 189, 33],
                                            backgroundColor: 'rgba(59, 130, 246, 0.8)'
                                        },
                                        {
                                            label: 'Last Week',
                                            data: [8907, 6230, 445, 178, 35],
                                            backgroundColor: 'rgba(16, 185, 129, 0.8)'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Weekly Performance Comparison Matrix',
                        columns: ['Week', 'Orders', 'Revenue', 'AOV', 'CVR%', 'WoW Growth'],
                        data: [
                            ['Jun 23-29', '35', '$4,536', '$129.60', '0.39%', '+16.7%'],
                            ['Jun 16-22', '30', '$3,991', '$133.03', '0.36%', '+11.4%'],
                            ['Jun 9-15', '25', '$3,584', '$143.36', '0.32%', '-15.2%'],
                            ['Jun 2-8', '28', '$4,229', '$151.04', '0.38%', '+34.5%'],
                            ['May 26-Jun 1', '22', '$3,145', '$142.95', '0.30%', '+23.8%'],
                            ['May 19-25', '18', '$2,540', '$141.11', '0.24%', '-24.6%'],
                            ['May 12-18', '26', '$3,371', '$129.65', '0.33%', '+50.9%'],
                            ['May 7-11', '14', '$2,233', '$159.50', '0.21%', 'Baseline']
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'productMixEvolution',
                                type: 'line',
                                title: 'Product Mix Evolution Over Time',
                                data: {
                                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                                    datasets: [
                                        {
                                            label: 'M1 Revenue Share %',
                                            data: [85, 82, 80, 78, 77, 76, 77, 78],
                                            borderColor: '#3B82F6',
                                            tension: 0.4
                                        },
                                        {
                                            label: 'Steamer Revenue Share %',
                                            data: [15, 18, 20, 22, 22, 23, 22, 21],
                                            borderColor: '#8B5CF6',
                                            tension: 0.4
                                        },
                                        {
                                            label: 'P1 Revenue Share %',
                                            data: [0, 0, 0, 0, 1, 1, 1, 1],
                                            borderColor: '#10B981',
                                            tension: 0.4
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'efficiencyHeatmap',
                                type: 'scatter',
                                title: 'Channel Efficiency Matrix (Bubble Size = Revenue)',
                                data: {
                                    datasets: [
                                        {
                                            label: 'Website',
                                            data: [{x: 85, y: 402, r: 69}],
                                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                                            borderColor: '#3B82F6'
                                        },
                                        {
                                            label: 'Amazon',
                                            data: [{x: 65, y: 174, r: 29}],
                                            backgroundColor: 'rgba(16, 185, 129, 0.6)',
                                            borderColor: '#10B981'
                                        },
                                        {
                                            label: 'TikTok Shop',
                                            data: [{x: 40, y: 96, r: 2}],
                                            backgroundColor: 'rgba(236, 72, 153, 0.6)',
                                            borderColor: '#EC4899'
                                        },
                                        {
                                            label: 'Social Links',
                                            data: [{x: 5, y: 56, r: 1}],
                                            backgroundColor: 'rgba(245, 158, 11, 0.6)',
                                            borderColor: '#F59E0B'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 YoY/MoM Strategic Insights & Growth Opportunities',
                        insights: [
                            {
                                icon: '📈',
                                title: 'Exponential Growth Trajectory',
                                description: 'Revenue grew 127% MoM with accelerating weekly growth rate of 12%',
                                priority: 'high',
                                metrics: 'May: $11,720 → June: $26,587 | Weekly CAGR: 12% | Projection: $60K by August'
                            },
                            {
                                icon: '🎯',
                                title: 'Channel Efficiency Divergence',
                                description: 'Website maintains 5x higher efficiency than other channels despite lower traffic',
                                priority: 'high',
                                metrics: 'Website CVR: 0.85% | Others: 0.15% | Efficiency Gap: 467%'
                            },
                            {
                                icon: '🚀',
                                title: 'Product Portfolio Optimization',
                                description: 'Steamer showing 168% MoM growth while maintaining healthy margins',
                                priority: 'high',
                                metrics: 'Steamer Growth: 168% | Order Share: 38% | Revenue Potential: $10K/month'
                            },
                            {
                                icon: '⚡',
                                title: 'Conversion Rate Recovery',
                                description: 'CVR improved from 0.15% to 0.48% through optimization efforts',
                                priority: 'medium',
                                metrics: 'May Avg: 0.15% | June Avg: 0.48% | Improvement: 220%'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Double Down on Website Channel',
                                action: 'Invest $10K in SEO and content marketing to capitalize on 85% conversion rate',
                                impact: 'Project 3x website traffic → $100K monthly revenue',
                                timeline: 'Next 60 days'
                            },
                            {
                                title: 'Steamer Product Line Extension',
                                action: 'Launch 3 complementary products in the steamer category',
                                impact: 'Capture 168% growth momentum → $30K incremental revenue',
                                timeline: 'Q3 2025'
                            },
                            {
                                title: 'Fix Conversion Funnel Leaks',
                                action: 'Implement abandoned cart recovery and checkout optimization',
                                impact: 'Increase overall CVR from 0.48% to 1.5%',
                                timeline: 'Next 30 days'
                            },
                            {
                                title: 'Scale Instagram Success Formula',
                                action: 'Produce 20 Reels monthly using viral format blueprint',
                                impact: 'Replicate 19-order success → 200+ monthly orders',
                                timeline: 'Immediate start'
                            }
                        ]
                    }
                ]
            },
            
            biweekly: {
                title: 'Weekly Performance Report (June 8-22, 2025)',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Total Orders', value: '53', trend: '📦', change: 'M1:22 Steamer:31', color: '#10B981' },
                            { label: 'Total Revenue', value: '$13.3K', trend: '+', change: 'Weekly Total', color: '#10B981' },
                            { label: 'Total Cost', value: '$1,913', trend: '✓', change: 'Samples + Shipping', color: '#10B981' },
                            { label: 'ROI', value: '6.97x', trend: '🚀', change: 'No Marketing Cost', color: '#10B981' }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'biweeklyChannelChart',
                                type: 'bar',
                                title: 'Channel Performance (June 8-22)',
                                data: {
                                    labels: ['Website', 'Amazon US', 'TikTok Shop'],
                                    datasets: [
                                        {
                                            label: 'M1 Orders',
                                            data: [13, 9, 0],
                                            backgroundColor: '#3B82F6'
                                        },
                                        {
                                            label: 'Steamer Orders',
                                            data: [2, 28, 1],
                                            backgroundColor: '#8B5CF6'
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'biweeklyRevenueChart',
                                type: 'doughnut',
                                title: 'Revenue Distribution by Platform',
                                data: {
                                    labels: ['Website ($11,247)', 'Amazon ($1,990)', 'TikTok ($90)'],
                                    datasets: [{
                                        data: [11247, 1990, 90],
                                        backgroundColor: ['#3B82F6', '#10B981', '#EC4899']
                                    }]
                                }
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Product Performance Summary',
                        columns: ['Product', 'Platform', 'Orders', 'Revenue', 'Avg Price', 'Key Driver'],
                        data: [
                            ['M1', 'Website', '13', '$6,227', '$479', 'Direct Traffic'],
                            ['M1', 'Amazon', '9', '$2,520', '$280', 'Instagram Reel'],
                            ['Steamer', 'Amazon', '28', '$600', '$21.43', 'Attribution + CC'],
                            ['Steamer', 'Website', '2', '$180', '$90', 'SEO'],
                            ['Steamer', 'TikTok', '1', '$90', '$90', 'Organic']
                        ]
                    },
                    {
                        type: 'highlight',
                        items: [
                            {
                                icon: '🔥',
                                title: 'Instagram Reel Impact',
                                description: 'Single video drove exceptional results',
                                stats: { Link: 'DKUTKK4J3Ra', Conversions: '19', Platform: 'Amazon' }
                            },
                            {
                                icon: '📊',
                                title: 'Channel Distribution',
                                description: 'Website dominates revenue share',
                                stats: { Website: '84.4%', Amazon: '14.9%', TikTok: '0.7%' }
                            }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'biweeklyProductMixChart',
                                type: 'bar',
                                title: 'Product Mix Analysis',
                                horizontal: true,
                                data: {
                                    labels: ['M1 Website', 'M1 Amazon', 'Steamer Amazon', 'Steamer Website', 'Steamer TikTok', 'P1 Amazon'],
                                    datasets: [{
                                        label: 'Revenue ($)',
                                        data: [10867, 4420, 600, 380, 90, 86],
                                        backgroundColor: function(context) {
                                            const product = context.chart.data.labels[context.dataIndex];
                                            if (product.includes('M1')) return '#3B82F6';
                                            if (product.includes('Steamer')) return '#8B5CF6';
                                            return '#10B981';
                                        }
                                    }]
                                }
                            },
                            {
                                id: 'biweeklyConversionFunnelChart',
                                type: 'line',
                                title: 'Conversion Metrics by Channel',
                                data: {
                                    labels: ['Website', 'Amazon', 'TikTok Shop'],
                                    datasets: [
                                        {
                                            label: 'Average Order Value ($)',
                                            data: [402, 65, 90],
                                            borderColor: '#10B981',
                                            yAxisID: 'y'
                                        },
                                        {
                                            label: 'Orders',
                                            data: [28, 37, 1],
                                            borderColor: '#3B82F6',
                                            yAxisID: 'y1'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Weekly Performance Insights & Actions',
                        insights: [
                            {
                                icon: '💎',
                                title: 'Premium Positioning Success',
                                description: 'M1 commands $440+ on website, validating premium strategy',
                                priority: 'high',
                                metrics: 'Website AOV: $440 | Amazon AOV: $280 | Price Gap: 57%'
                            },
                            {
                                icon: '🎬',
                                title: 'Content ROI Breakthrough',
                                description: 'Instagram content delivering 10x returns with zero ad spend',
                                priority: 'high',
                                metrics: 'Content Investment: $0 | Generated Revenue: $2,520 | Pure Profit'
                            },
                            {
                                icon: '📈',
                                title: 'Amazon Influencer Activation',
                                description: 'First influencer resource live, awaiting conversion data',
                                priority: 'medium',
                                metrics: 'Resources: 1 | Product: M1 | Status: Tracking'
                            },
                            {
                                icon: '🆕',
                                title: 'P1 Product Market Entry',
                                description: 'First P1 sale recorded on Amazon, indicating market acceptance',
                                priority: 'medium',
                                metrics: 'First Sale: $85.66 | Platform: Amazon | Potential: High'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Instagram Content Scaling',
                                action: 'Produce 5 Reels weekly using proven format from DKUTKK4J3Ra',
                                impact: 'Project 100+ monthly orders',
                                timeline: 'Start This Week'
                            },
                            {
                                title: 'Website Premium Strategy',
                                action: 'Enhance product pages with premium content and upsells',
                                impact: 'Increase AOV to $500+',
                                timeline: 'Next 2 Weeks'
                            },
                            {
                                title: 'Amazon Price Optimization',
                                action: 'Test M1 pricing at $350-380 to close website gap',
                                impact: '25% revenue increase',
                                timeline: 'A/B Test This Week'
                            },
                            {
                                title: 'P1 Product Launch',
                                action: 'Create dedicated content strategy for P1 based on first sale',
                                impact: 'New revenue stream',
                                timeline: 'Next Month'
                            }
                        ]
                    }
                ]
            },
            
            products: {
                title: 'Product Portfolio Analysis',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Active Products', value: '3', trend: '📦', change: 'M1, Steamer, P1', color: '#3B82F6' },
                            { label: 'Hero Product', value: 'M1', trend: '⭐', change: '77% of Revenue', color: '#10B981' },
                            { label: 'Growth Product', value: 'Steamer', trend: '📈', change: '168% Growth', color: '#10B981' },
                            { label: 'New Entry', value: 'P1', trend: '🆕', change: 'First Sale', color: '#F59E0B' }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'productPortfolioChart',
                                type: 'radar',
                                title: 'Product Performance Matrix',
                                data: {
                                    labels: ['Revenue Share', 'Order Volume', 'AOV Index', 'Growth Rate', 'Channel Diversity'],
                                    datasets: [
                                        {
                                            label: 'M1 Litter Box',
                                            data: [77, 42, 100, 60, 40],
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.2)'
                                        },
                                        {
                                            label: 'Steamer',
                                            data: [22, 58, 20, 100, 60],
                                            borderColor: '#8B5CF6',
                                            backgroundColor: 'rgba(139, 92, 246, 0.2)'
                                        },
                                        {
                                            label: 'P1',
                                            data: [1, 2, 19, 50, 20],
                                            borderColor: '#10B981',
                                            backgroundColor: 'rgba(16, 185, 129, 0.2)'
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'productLifecycleChart',
                                type: 'scatter',
                                title: 'Product Lifecycle Position',
                                data: {
                                    datasets: [
                                        {
                                            label: 'M1',
                                            data: [{x: 75, y: 77}],
                                            backgroundColor: '#3B82F6',
                                            pointRadius: 15
                                        },
                                        {
                                            label: 'Steamer',
                                            data: [{x: 40, y: 22}],
                                            backgroundColor: '#8B5CF6',
                                            pointRadius: 12
                                        },
                                        {
                                            label: 'P1',
                                            data: [{x: 10, y: 1}],
                                            backgroundColor: '#10B981',
                                            pointRadius: 8
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Product Comparison Matrix',
                        columns: ['Metric', 'M1 Litter Box', 'Steamer', 'P1'],
                        data: [
                            ['Total Orders', '42', '58', '1'],
                            ['Revenue', '$14,979', '$2,878', '$86'],
                            ['Average Price', '$357', '$50', '$86'],
                            ['Best Channel', 'Website', 'Amazon', 'Amazon'],
                            ['Growth Status', 'Mature', 'Growing', 'Testing']
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Product Strategy Insights',
                        insights: [
                            {
                                icon: '💎',
                                title: 'M1 Premium Leader',
                                description: 'M1 maintains premium positioning with highest AOV and revenue share',
                                priority: 'high',
                                metrics: 'Revenue: 77% | AOV: $357 | Channel: Website-First'
                            },
                            {
                                icon: '🚀',
                                title: 'Steamer Volume Driver',
                                description: 'Steamer shows highest order volume and growth trajectory',
                                priority: 'high',
                                metrics: 'Orders: 58 | Growth: 168% | Multi-Channel Success'
                            },
                            {
                                icon: '🌱',
                                title: 'P1 Market Entry',
                                description: 'P1 shows initial market acceptance with first Amazon sale',
                                priority: 'medium',
                                metrics: 'First Sale: $86 | Platform: Amazon | Status: Validation Phase'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'M1 Premium Enhancement',
                                action: 'Develop premium bundles and accessories for website channel',
                                impact: 'Increase AOV to $500+',
                                timeline: 'Q3 2025'
                            },
                            {
                                title: 'Steamer Scale Strategy',
                                action: 'Triple content production for high-volume product',
                                impact: 'Reach 200+ monthly orders',
                                timeline: 'Next Month'
                            },
                            {
                                title: 'P1 Launch Campaign',
                                action: 'Create dedicated launch strategy with influencer seeding',
                                impact: 'Establish third revenue pillar',
                                timeline: 'Next Quarter'
                            }
                        ]
                    }
                ]
            },
            
            steamer: {
                title: 'Steamer Weekly Performance Analysis (May 7 - June 29)',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Total Clicks', value: '27,066', trend: '📊', change: 'Across 8 weeks', color: '#3B82F6' },
                            { label: 'Total Orders', value: '40', trend: '⚠️', change: 'CVR 0.15%', color: '#F59E0B' },
                            { label: 'Total Revenue', value: '$4,062', trend: '💰', change: 'AOV $101.55', color: '#10B981' },
                            { label: 'Platform Status', value: '2 of 3', trend: '🚨', change: 'TTS Zero', color: '#EF4444' }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'steamerWeeklyChart',
                                type: 'line',
                                title: 'Weekly Orders Trend by Platform',
                                data: {
                                    labels: ['May 7-11', 'May 12-18', 'May 19-25', 'May 26-Jun 1', 'Jun 2-8', 'Jun 9-15', 'Jun 16-22', 'Jun 23-29'],
                                    datasets: [
                                        {
                                            label: 'DTC Orders',
                                            data: [0, 1, 0, 1, 7, 3, 2, 2],
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                            fill: true,
                                            tension: 0.4
                                        },
                                        {
                                            label: 'Amazon Orders',
                                            data: [2, 2, 3, 6, 2, 3, 3, 3],
                                            borderColor: '#10B981',
                                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                            fill: true,
                                            tension: 0.4
                                        },
                                        {
                                            label: 'TTS Orders',
                                            data: [0, 0, 0, 0, 0, 0, 0, 0],
                                            borderColor: '#EF4444',
                                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                            fill: true,
                                            tension: 0.4
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'steamerRevenueChart',
                                type: 'bar',
                                title: 'Weekly Revenue Comparison',
                                data: {
                                    labels: ['May 7-11', 'May 12-18', 'May 19-25', 'May 26-Jun 1', 'Jun 2-8', 'Jun 9-15', 'Jun 16-22', 'Jun 23-29'],
                                    datasets: [
                                        {
                                            label: 'DTC Revenue',
                                            data: [0, 99.99, 0, 99.99, 973.21, 287.97, 287.97, 179.10],
                                            backgroundColor: '#3B82F6'
                                        },
                                        {
                                            label: 'Amazon Revenue',
                                            data: [176.65, 179.98, 269.97, 549.94, 182.65, 269.97, 269.97, 234.63],
                                            backgroundColor: '#10B981'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Weekly Performance Details',
                        columns: ['Week', 'Platform', 'Clicks', 'Orders', 'Revenue', 'CVR%'],
                        data: [
                            ['Jun 2-8', 'DTC', '1,935', '7', '$973.21', '0.36%'],
                            ['May 26-Jun 1', 'Amazon', '1,900', '6', '$549.94', '0.32%'],
                            ['Jun 9-15', 'DTC', '1,447', '3', '$287.97', '0.21%'],
                            ['May 19-25', 'Amazon', '1,800', '3', '$269.97', '0.17%'],
                            ['May 12-18', 'DTC', '2,758', '1', '$99.99', '0.04%']
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'steamerPlatformPie',
                                type: 'doughnut',
                                title: 'Platform Share Analysis',
                                data: {
                                    labels: ['DTC Share', 'Amazon Share', 'TTS Share'],
                                    datasets: [{
                                        data: [47.5, 52.5, 0],
                                        backgroundColor: ['#3B82F6', '#10B981', '#EF4444']
                                    }]
                                }
                            },
                            {
                                id: 'steamerCVRChart',
                                type: 'bar',
                                title: 'Conversion Rate by Week',
                                data: {
                                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                                    datasets: [{
                                        label: 'CVR %',
                                        data: [0.11, 0.12, 0.17, 0.32, 0.36, 0.21, 0.20, 0.19],
                                        backgroundColor: function(context) {
                                            const value = context.raw;
                                            if (value >= 0.3) return '#10B981';
                                            if (value >= 0.2) return '#3B82F6';
                                            if (value >= 0.1) return '#F59E0B';
                                            return '#EF4444';
                                        }
                                    }]
                                }
                            }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Steamer Product Strategic Insights & Recommendations',
                        insights: [
                            {
                                icon: '🔥',
                                title: 'DTC Peak Performance Week',
                                description: 'June 2-8 showed exceptional DTC performance with 7 orders from 1,935 clicks',
                                priority: 'high',
                                metrics: 'Peak Week Revenue: $973.21 | CVR: 0.36% | 3x Average'
                            },
                            {
                                icon: '⚡',
                                title: 'Amazon Consistency Advantage',
                                description: 'Amazon maintains steady 2-6 orders weekly with minimal variance',
                                priority: 'high',
                                metrics: 'Average Weekly Orders: 3 | Revenue Share: 52.5% | Stability: High'
                            },
                            {
                                icon: '🚨',
                                title: 'TikTok Shop Complete Failure',
                                description: 'Zero clicks and orders across entire 8-week period indicates fundamental issues',
                                priority: 'critical',
                                metrics: 'Performance: 0% | Lost Opportunity: ~$2,000 | Action: Urgent'
                            },
                            {
                                icon: '📉',
                                title: 'High-Click Low-Conversion Pattern',
                                description: 'Multiple weeks show 1,000+ clicks with minimal conversions',
                                priority: 'high',
                                metrics: 'Worst Case: 2,758 clicks → 1 order | Average CVR: 0.15%'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Replicate DTC Success Formula',
                                action: 'Analyze June 2-8 campaign elements and scale winning creative/targeting',
                                impact: 'Maintain 0.3%+ CVR across all weeks',
                                timeline: 'Immediate'
                            },
                            {
                                title: 'Amazon Listing Enhancement',
                                action: 'Leverage consistent traffic with A+ content and video demonstrations',
                                impact: 'Increase AOV from $89 to $120',
                                timeline: 'Next 2 weeks'
                            },
                            {
                                title: 'TikTok Shop Emergency Activation',
                                action: 'Complete full audit: product listing, pricing, content, and creator partnerships',
                                impact: 'Capture 30% platform share within 60 days',
                                timeline: 'This week'
                            },
                            {
                                title: 'Landing Page Conversion Optimization',
                                action: 'Implement exit-intent popups, trust badges, and checkout simplification',
                                impact: 'Double overall CVR to 0.3%',
                                timeline: 'Next sprint'
                            }
                        ]
                    },
                    {
                        type: 'alerts',
                        items: [
                            { type: 'danger', title: 'TikTok Shop Zero Performance', text: 'Complete platform failure requires immediate intervention' },
                            { type: 'danger', title: 'Sub-optimal Conversion Rate', text: '0.15% overall CVR is 10x below industry standard' },
                            { type: 'success', title: 'Amazon Channel Stability', text: 'Consistent weekly performance provides reliable baseline' },
                            { type: 'success', title: 'DTC Growth Potential', text: 'June peak proves 3x performance is achievable' }
                        ]
                    }
                ]
            },
            
            litterbox: {
                title: 'Smart Litter Box Phase 3 Performance Report (May 7 - June 29)',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Total Clicks', value: '28,226', trend: '⚠️', change: 'High Traffic', color: '#F59E0B' },
                            { label: 'Total Orders', value: '4', trend: '🚨', change: 'CVR 0.014%', color: '#EF4444' },
                            { label: 'Total Revenue', value: '$1,072', trend: '📉', change: 'Critical', color: '#EF4444' },
                            { label: 'Last Order', value: 'May 18', trend: '⏰', change: '6 Weeks Ago', color: '#EF4444' }
                        ]
                    },
                    {
                        type: 'alerts',
                        items: [
                            { type: 'danger', title: 'Traffic Trap Alert', text: '28,226 clicks generated only 4 orders - immediate intervention required' },
                            { type: 'danger', title: 'Zero Conversions for 6 Weeks', text: 'No orders since May 18 despite continuous traffic' },
                            { type: 'danger', title: 'Platform Failure Rate 99.986%', text: 'Current conversion rate is 700x below industry standard' },
                            { type: 'danger', title: 'TikTok Shop Complete Failure', text: 'Zero clicks and orders - platform not activated' },
                            { type: 'success', title: 'Analyze May 12-18 Success', text: 'Study the only week with conversions to identify winning factors' },
                            { type: 'success', title: 'Implement Heat Mapping', text: 'Deploy Hotjar or similar tools to identify exact drop-off points' },
                            { type: 'success', title: 'Test Price Reduction', text: 'Run 30-50% discount test to validate price sensitivity' },
                            { type: 'success', title: 'Fix Technical Issues', text: 'Complete checkout flow audit on all devices and browsers' }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'litterboxWeeklyChart',
                                type: 'line',
                                title: 'Weekly Click vs Order Performance',
                                data: {
                                    labels: ['May 7-11', 'May 12-18', 'May 19-25', 'May 26-Jun 1', 'Jun 2-8', 'Jun 9-15', 'Jun 16-22', 'Jun 23-29'],
                                    datasets: [
                                        {
                                            label: 'Total Clicks',
                                            data: [2394, 2893, 2491, 2598, 2670, 2696, 3577, 8907],
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                            yAxisID: 'y',
                                            tension: 0.4
                                        },
                                        {
                                            label: 'Orders (x100)',
                                            data: [100, 400, 0, 0, 0, 0, 0, 0],
                                            borderColor: '#EF4444',
                                            backgroundColor: 'rgba(239, 68, 68, 0.3)',
                                            yAxisID: 'y1',
                                            type: 'bar'
                                        }
                                    ]
                                }
                            },
                            {
                                id: 'litterboxPlatformChart',
                                type: 'bar',
                                title: 'Platform Performance Comparison',
                                data: {
                                    labels: ['Litter Box Site', 'DTC', 'Amazon', 'TikTok Shop'],
                                    datasets: [
                                        {
                                            label: 'Clicks',
                                            data: [14113, 2720, 11393, 0],
                                            backgroundColor: '#3B82F6'
                                        },
                                        {
                                            label: 'Orders (x1000)',
                                            data: [2000, 1000, 1000, 0],
                                            backgroundColor: '#10B981'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Platform Performance Details',
                        columns: ['Platform', 'Total Clicks', 'Orders', 'Revenue', 'CVR%', 'Status'],
                        data: [
                            ['Litter Box Site', '14,113', '2', '$535.97', '0.014%', 'Critical'],
                            ['DTC', '2,720', '1', '$55.99', '0.037%', 'Critical'],
                            ['Amazon', '11,393', '1', '$479.98', '0.009%', 'Critical'],
                            ['TikTok Shop', '0', '0', '$0.00', '0%', 'Not Active']
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'litterboxFunnelChart',
                                type: 'bar',
                                title: 'Conversion Funnel Analysis',
                                horizontal: true,
                                data: {
                                    labels: ['Total Clicks', 'Est. Product Views', 'Est. Add to Cart', 'Actual Orders', 'Completed Orders'],
                                    datasets: [{
                                        label: 'Users',
                                        data: [28226, 14113, 282, 4, 4],
                                        backgroundColor: function(context) {
                                            const colors = ['#3B82F6', '#6366F1', '#8B5CF6', '#EF4444', '#DC2626'];
                                            return colors[context.dataIndex];
                                        }
                                    }]
                                }
                            },
                            {
                                id: 'litterboxRevenueTrend',
                                type: 'doughnut',
                                title: 'Revenue Distribution by Week',
                                data: {
                                    labels: ['May 12-18 (Active)', 'May 19-Jun 29 (Dead)'],
                                    datasets: [{
                                        data: [1071.94, 0],
                                        backgroundColor: ['#10B981', '#EF4444']
                                    }]
                                }
                            }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🚨 Critical Performance Analysis & Emergency Actions',
                        insights: [
                            {
                                icon: '💥',
                                title: 'Catastrophic Conversion Failure',
                                description: 'With 28,226 clicks yielding only 4 orders, the funnel is fundamentally broken',
                                priority: 'critical',
                                metrics: 'CVR: 0.014% | Industry Standard: 1-2% | Gap: 99%+'
                            },
                            {
                                icon: '🕐',
                                title: '6-Week Sales Drought',
                                description: 'All 4 conversions occurred in one week (May 12-18), followed by complete failure',
                                priority: 'critical',
                                metrics: 'Last Order: May 18 | Days Since: 42 | Revenue Loss: ~$28,000'
                            },
                            {
                                icon: '📈',
                                title: 'June 23-29 Traffic Spike Wasted',
                                description: '8,907 clicks (31.5% of total) with zero conversions indicates severe issues',
                                priority: 'critical',
                                metrics: 'Peak Week Clicks: 8,907 | Conversions: 0 | Wasted Opportunity: 100%'
                            },
                            {
                                icon: '🔴',
                                title: 'Multi-Platform System Failure',
                                description: 'All platforms show critical CVR issues, suggesting product-market fit problems',
                                priority: 'critical',
                                metrics: 'Failed Platforms: 3/4 | TTS Status: Not Started | Fix Priority: Immediate'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Emergency Funnel Audit',
                                action: 'Deploy heatmap tools, conduct user recordings, and identify exact drop-off points within 24 hours',
                                impact: 'Identify and fix conversion blockers',
                                timeline: 'Within 24 hours'
                            },
                            {
                                title: 'Price & Value Proposition Testing',
                                action: 'Test 30-50% price reduction or bundle offers to validate price sensitivity',
                                impact: 'Determine if pricing is the barrier',
                                timeline: 'This week'
                            },
                            {
                                title: 'Replicate May 12-18 Success',
                                action: 'Analyze exact content, pricing, and user journey from the only successful week',
                                impact: 'Restore baseline conversion rate',
                                timeline: 'Immediate'
                            },
                            {
                                title: 'Payment & Technical Debugging',
                                action: 'Test complete checkout flow on all devices and payment methods',
                                impact: 'Eliminate technical barriers',
                                timeline: 'Today'
                            },
                            {
                                title: 'Trust & Social Proof Injection',
                                action: 'Add reviews, testimonials, money-back guarantees, and security badges',
                                impact: 'Build conversion confidence',
                                timeline: 'Within 48 hours'
                            },
                            {
                                title: 'TikTok Shop Activation',
                                action: 'Complete product listing and launch with creator partnerships',
                                impact: 'Open new revenue channel',
                                timeline: 'Next week'
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Weekly Performance Breakdown',
                        columns: ['Week', 'Litter Box Clicks', 'DTC Clicks', 'Amazon Clicks', 'Total Orders', 'Revenue'],
                        data: [
                            ['May 7-11', '1,342', '313', '739', '1', '$55.99'],
                            ['May 12-18', '1,267', '346', '1,280', '3', '$1,015.95'],
                            ['May 19-25', '1,206', '332', '953', '0', '$0.00'],
                            ['May 26-Jun 1', '1,217', '346', '1,035', '0', '$0.00'],
                            ['Jun 2-8', '1,251', '354', '1,065', '0', '$0.00'],
                            ['Jun 9-15', '1,237', '358', '1,101', '0', '$0.00'],
                            ['Jun 16-22', '986', '371', '2,220', '0', '$0.00'],
                            ['Jun 23-29', '5,607', '300', '3,000', '0', '$0.00']
                        ]
                    }
                ]
            },
            
            channels: {
                title: 'Channel Analysis - Trinity Layout',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Website CVR', value: 'Highest', change: 'M1 Leading', color: '#10B981' },
                            { label: 'Amazon Avg Price', value: '$202', change: 'CC Converting', color: '#10B981' },
                            { label: 'TikTok Shop', value: 'Growing', change: '3 Order Test', color: '#10B981' },
                            { label: 'Current ROI', value: 'Excellent', change: 'Zero Ad Spend', color: '#10B981' }
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'channelRadar',
                                type: 'radar',
                                title: 'Channel Performance Comparison',
                                data: {
                                    labels: ['Revenue Share', 'Order Volume', 'Avg Order Value', 'Efficiency'],
                                    datasets: [
                                        {
                                            label: 'Website',
                                            data: [69, 28, 80, 100],
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.2)'
                                        },
                                        {
                                            label: 'Amazon US',
                                            data: [29, 27, 35, 80],
                                            borderColor: '#10B981',
                                            backgroundColor: 'rgba(16, 185, 129, 0.2)'
                                        },
                                        {
                                            label: 'TikTok Shop',
                                            data: [2, 3, 20, 40],
                                            borderColor: '#EC4899',
                                            backgroundColor: 'rgba(236, 72, 153, 0.2)'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Channel Metrics Comparison',
                        columns: ['Metric', 'Website', 'Amazon US', 'TikTok Shop'],
                        data: [
                            ['Revenue Share', '69%', '29%', '2%'],
                            ['Order Volume', '28', '27', '3'],
                            ['Avg Order Value', '$402', '$174', '$96'],
                            ['Efficiency Score', '100', '80', '40']
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Channel Optimization Insights & Recommendations',
                        insights: [
                            {
                                icon: '🌟',
                                title: 'Website Channel Excellence',
                                description: 'Direct website delivers highest AOV at $402 with superior conversion',
                                priority: 'high',
                                metrics: 'AOV: $402 | Revenue Share: 69% | Efficiency: 100%'
                            },
                            {
                                icon: '📱',
                                title: 'Amazon Volume Opportunity',
                                description: 'Amazon matches website in order volume but at 43% of AOV',
                                priority: 'high',
                                metrics: 'Orders: 27 vs 28 | AOV Gap: $228'
                            },
                            {
                                icon: '🎥',
                                title: 'TikTok Shop Early Success',
                                description: 'TikTok Shop validates with 3 orders despite minimal effort',
                                priority: 'medium',
                                metrics: 'Orders: 3 | AOV: $96 | Growth Potential: High'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Website SEO Enhancement',
                                action: 'Invest in content marketing and SEO to drive more direct traffic',
                                impact: 'Double website orders in 3 months',
                                timeline: 'Start immediately'
                            },
                            {
                                title: 'Amazon Listing Optimization',
                                action: 'Upgrade product images and A+ content to justify higher pricing',
                                impact: 'Increase Amazon AOV by 25%',
                                timeline: 'Next 2 weeks'
                            },
                            {
                                title: 'TikTok Shop Scaling',
                                action: 'Partner with 5-10 micro-influencers for product seeding',
                                impact: '10x TikTok Shop orders',
                                timeline: 'Next month'
                            }
                        ]
                    }
                ]
            },
            
            campaign: {
                title: 'Campaign ROI Analysis',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Total Clicks', value: '21.3K', change: '8 Campaigns', color: '#3B82F6' },
                            { label: 'Total Revenue', value: '$2,445', change: 'Commission $257', color: '#3B82F6' },
                            { label: 'Conversions', value: '22', change: 'CVR 0.1%', color: '#EF4444' },
                            { label: 'Best Channel', value: 'Instagram', change: '21 Conversions', color: '#10B981' }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Campaign Performance Details',
                        columns: ['Campaign', 'Channel', 'Clicks', 'Orders', 'Revenue', 'CVR'],
                        data: [
                            ['magic1_ig', 'Instagram', '4,956', '12', '$1,064.88', '0.24%'],
                            ['m1_ig_G2', 'Instagram', '5,733', '9', '$809.91', '0.16%'],
                            ['m1_tk', 'TikTok', '8,237', '0', '$0.00', '0.00%'],
                            ['m1_ytb', 'YouTube', '62', '2', '$569.97', '3.23%']
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'funnelChart',
                                type: 'bar',
                                title: 'Conversion Funnel',
                                horizontal: true,
                                data: {
                                    labels: ['Instagram Clicks', 'TikTok Clicks', 'Instagram ATC', 'Instagram Orders', 'YouTube Orders'],
                                    datasets: [{
                                        label: 'Users',
                                        data: [13007, 8237, 337, 21, 2],
                                        backgroundColor: ['#3B82F6', '#6366F1', '#8B5CF6', '#A78BFA', '#C4B5FD']
                                    }]
                                }
                            },
                            {
                                id: 'campaignBar',
                                type: 'bar',
                                title: 'Campaign Performance',
                                data: {
                                    labels: ['magic1_ig', 'm1_ig_G2', 'm1_tk', 'm1_ytb'],
                                    datasets: [
                                        {
                                            label: 'Clicks',
                                            data: [4956, 5733, 8237, 62],
                                            backgroundColor: '#3B82F6'
                                        },
                                        {
                                            label: 'Orders (×100)',
                                            data: [1200, 900, 0, 200],
                                            backgroundColor: '#10B981'
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Campaign Performance Insights & Recommendations',
                        insights: [
                            {
                                icon: '📱',
                                title: 'Instagram Campaign Excellence',
                                description: 'Instagram campaigns generated 95% of all conversions with 0.20% average CVR',
                                priority: 'high',
                                metrics: 'Conversions: 21/22 | Revenue: $1,874.79 | CVR: 0.20%'
                            },
                            {
                                icon: '⚠️',
                                title: 'TikTok Traffic Quality Issue',
                                description: '8,237 TikTok clicks resulted in zero conversions indicating targeting problems',
                                priority: 'critical',
                                metrics: 'Clicks: 8,237 | Conversions: 0 | Wasted Traffic: 100%'
                            },
                            {
                                icon: '🎬',
                                title: 'YouTube High-Value Conversions',
                                description: 'YouTube shows highest CVR at 3.23% with premium AOV of $285',
                                priority: 'medium',
                                metrics: 'CVR: 3.23% | AOV: $285 | Quality: Excellent'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Double Down on Instagram',
                                action: 'Increase Instagram campaign budget by 200% focusing on magic1 format',
                                impact: 'Project 50+ conversions monthly',
                                timeline: 'Immediate'
                            },
                            {
                                title: 'Pause TikTok Campaigns',
                                action: 'Stop all TikTok paid campaigns and focus on organic content only',
                                impact: 'Save wasted ad spend',
                                timeline: 'Today'
                            },
                            {
                                title: 'Scale YouTube Strategy',
                                action: 'Create dedicated YouTube content strategy with product reviews',
                                impact: '10x high-value conversions',
                                timeline: 'Next 2 weeks'
                            }
                        ]
                    }
                ]
            },
            
            social: {
                title: 'Social Media Link Tracking',
                sections: [
                    {
                        type: 'metrics',
                        items: [
                            { label: 'Total Clicks', value: '1,938', change: '⚠️ Low Activity', color: '#F59E0B' },
                            { label: 'New Users', value: '1,759', change: '91% New', color: '#10B981' },
                            { label: 'Conversions', value: '1', change: '0.05% CVR', color: '#EF4444' },
                            { label: 'Revenue', value: '$55.99', change: 'Critical', color: '#EF4444' }
                        ]
                    },
                    {
                        type: 'table',
                        title: 'Platform Link Performance',
                        columns: ['Platform', 'Clicks', 'New Users', 'Conversions', 'Revenue'],
                        data: [
                            ['Instagram', '1,534', '1,387', '1', '$55.99'],
                            ['TikTok', '398', '372', '0', '$0.00'],
                            ['YouTube', '5', '0', '0', '$0.00'],
                            ['Story', '1', '0', '0', '$0.00']
                        ]
                    },
                    {
                        type: 'charts',
                        items: [
                            {
                                id: 'socialPie',
                                type: 'doughnut',
                                title: 'Platform Traffic Distribution',
                                data: {
                                    labels: ['Instagram', 'TikTok', 'YouTube', 'Story'],
                                    datasets: [{
                                        data: [1534, 398, 5, 1],
                                        backgroundColor: ['#4338CA', '#A21CAF', '#DC2626', '#6B7280']
                                    }]
                                }
                            }
                        ]
                    },
                    {
                        type: 'alerts',
                        items: [
                            { type: 'danger', title: '99.95% Traffic Loss', text: 'Only 1 conversion from 1,938 clicks' },
                            { type: 'danger', title: 'TikTok Zero Conversion', text: '398 clicks with 0 sales' },
                            { type: 'success', title: 'Landing Page Audit', text: 'Test loading speed and mobile UX' },
                            { type: 'success', title: 'Content Strategy', text: 'Review hook effectiveness' }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Social Link Performance Insights & Recommendations',
                        insights: [
                            {
                                icon: '🚨',
                                title: 'Critical Conversion Crisis',
                                description: '99.95% of social traffic fails to convert indicating severe funnel issues',
                                priority: 'critical',
                                metrics: 'CVR: 0.05% | Lost Opportunity: 1,937 visitors'
                            },
                            {
                                icon: '🔍',
                                title: 'High New User Acquisition',
                                description: '91% new user rate shows strong reach but poor conversion optimization',
                                priority: 'high',
                                metrics: 'New Users: 1,759 | Retention: Near Zero'
                            },
                            {
                                icon: '💔',
                                title: 'Platform Performance Failure',
                                description: 'All platforms except Instagram show zero conversions',
                                priority: 'critical',
                                metrics: 'Failed Platforms: 3/4 | Wasted Clicks: 404'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Emergency Landing Page Optimization',
                                action: 'Implement fast-loading, mobile-optimized landing pages for each platform',
                                impact: 'Increase CVR to industry standard 1-2%',
                                timeline: 'This week'
                            },
                            {
                                title: 'Link-to-Product Match',
                                action: 'Ensure social links lead directly to featured products, not homepage',
                                impact: '10x conversion rate improvement',
                                timeline: 'Within 48 hours'
                            },
                            {
                                title: 'Platform-Specific Content',
                                action: 'Create unique landing experiences for each social platform',
                                impact: 'Platform-optimized conversions',
                                timeline: 'Next 2 weeks'
                            }
                        ]
                    }
                ]
            },
            
            content: {
                title: 'Content Strategy - Instagram Reel Drove 19 Orders',
                sections: [
                    {
                        type: 'highlight',
                        items: [
                            {
                                icon: '🔥',
                                title: 'Instagram Reel Viral Success',
                                description: 'Single video drove massive conversion',
                                stats: { Conversions: '19', Channel: 'Amazon', ROI: '10x' }
                            },
                            {
                                icon: '📊',
                                title: 'Zero Cost Strategy',
                                description: 'Sample products only approach',
                                stats: { Investment: '$1,913', Return: '$13,328', ROI: '6.97x' }
                            }
                        ]
                    },
                    {
                        type: 'insights-recommendations',
                        title: '🎯 Content Strategy Insights & Recommendations',
                        insights: [
                            {
                                icon: '🚀',
                                title: 'Viral Content Formula Discovered',
                                description: 'Instagram Reel format proven to drive exceptional conversions',
                                priority: 'high',
                                metrics: 'Single Reel: 19 orders | No paid promotion | Pure organic reach'
                            },
                            {
                                icon: '💰',
                                title: 'Zero-Cost Marketing Validation',
                                description: 'Product sampling strategy delivers 6.97x ROI without advertising spend',
                                priority: 'high',
                                metrics: 'Investment: $1,913 | Return: $13,328 | Pure Profit: $11,415'
                            },
                            {
                                icon: '🎯',
                                title: 'Content-Channel Fit Confirmed',
                                description: 'Instagram Reels + Amazon conversion path validated',
                                priority: 'high',
                                metrics: 'Conversion Path: Instagram → Amazon | Success Rate: High'
                            }
                        ],
                        recommendations: [
                            {
                                title: 'Content Production Scale-Up',
                                action: 'Produce 3-5 Reels weekly following the viral format',
                                impact: 'Project 50-100 orders monthly',
                                timeline: 'Start this week'
                            },
                            {
                                title: 'Influencer Sampling Program',
                                action: 'Send products to 20-30 micro-influencers monthly',
                                impact: 'Exponential reach growth',
                                timeline: 'Launch next week'
                            },
                            {
                                title: 'Content Format Diversification',
                                action: 'Test YouTube Shorts and TikTok using same viral formula',
                                impact: 'Multi-platform viral potential',
                                timeline: 'Next month'
                            }
                        ]
                    }
                ]
            }
        };

        // Navigation Items - Reorganized by Category
        const NAV_ITEMS = [
            // Executive Summary
            { id: 'yoyAnalysis', name: 'YoY/MoM Analysis', icon: '📊', category: 'summary' },
            { id: 'biweekly', name: 'Weekly Performance', icon: '📈', category: 'summary' },
            
            // Product Analytics
            { id: 'products', name: 'Product Comparison', icon: '📦', category: 'products' },
            { id: 'steamer', name: 'Steamer Weekly Analysis', icon: '♨️', category: 'products' },
            { id: 'litterbox', name: 'Litter Box Phase 3 Report', icon: '🐱', category: 'products' },
            
            // Channel Analytics
            { id: 'channels', name: 'Channel Overview', icon: '📱', category: 'channels' },
            { id: 'campaign', name: 'Campaign ROI', icon: '🎯', category: 'channels' },
            { id: 'social', name: 'Social Link Tracking', icon: '🔗', category: 'channels' },
            
            // Content & Testing
            { id: 'content', name: 'Content Testing', icon: '🎬', category: 'testing' }
        ];

        // Dashboard Application
        class DashboardApp {
            constructor() {
                this.charts = {};
                this.currentTab = 'yoyAnalysis';
                this.init();
            }

            init() {
                try {
                    // Hide loading screen
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'flex';
                    
                    this.renderNavigation();
                    this.render('yoyAnalysis');
                } catch (error) {
                    console.error('Dashboard initialization error:', error);
                    // Still show the dashboard even if there's an error
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'flex';
                    
                    // Show error message
                    document.getElementById('dashboard').innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                            <h3 class="text-red-800 font-semibold mb-2">Dashboard Error</h3>
                            <p class="text-red-600">Some features may not be available.</p>
                            <button onclick="location.reload()" class="mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                                Reload Page
                            </button>
                        </div>
                    `;
                }
            }

            renderNavigation() {
                const nav = document.getElementById('navigation');
                const categories = {
                    summary: { name: 'Executive Summary', items: [] },
                    products: { name: 'Product Analytics', items: [] },
                    channels: { name: 'Channel Analytics', items: [] },
                    testing: { name: 'Testing & Optimization', items: [] }
                };
                
                // Group items by category
                NAV_ITEMS.forEach(item => {
                    if (categories[item.category]) {
                        categories[item.category].items.push(item);
                    }
                });
                
                // Render categorized navigation
                let navHTML = '';
                Object.entries(categories).forEach(([key, category], index) => {
                    if (category.items.length > 0) {
                        // Add separator between categories except for the first one
                        if (index > 0) {
                            navHTML += '<div class="border-t border-slate-700 my-4"></div>';
                        }
                        navHTML += `
                            <div class="mb-4">
                                <h3 class="nav-category-header">${category.name}</h3>
                                ${category.items.map(item => `
                                    <a href="#" onclick="window.dashboardApp.render('${item.id}'); return false;" 
                                       id="nav-${item.id}"
                                       class="nav-item flex items-center gap-3 px-4 py-2 rounded hover:bg-slate-700 transition mb-1">
                                        <span>${item.icon}</span>
                                        <span>${item.name}</span>
                                    </a>
                                `).join('')}
                            </div>
                        `;
                    }
                });
                
                nav.innerHTML = navHTML;
            }

            render(tabId) {
                this.currentTab = tabId;
                const config = DASHBOARD_CONFIG[tabId];
                if (!config) return;

                // Update navigation
                document.querySelectorAll('.nav-item').forEach(el => {
                    el.classList.remove('bg-slate-700', 'border-l-4', 'border-blue-500');
                });
                const activeNav = document.getElementById(`nav-${tabId}`);
                if (activeNav) {
                    activeNav.classList.add('bg-slate-700', 'border-l-4', 'border-blue-500');
                }

                // Update title
                document.getElementById('pageTitle').textContent = config.title;

                // Clear existing charts
                Object.values(this.charts).forEach(chart => {
                    if (chart && chart.destroy) chart.destroy();
                });
                this.charts = {};

                // Render sections
                const dashboard = document.getElementById('dashboard');
                dashboard.innerHTML = config.sections.map(section => this.renderSection(section)).join('');

                // Initialize charts after DOM update (if Chart.js is available)
                if (!window.NO_CHARTS && window.chartJsLoaded) {
                    setTimeout(() => this.initCharts(config.sections), 250);
                }
            }

            renderSection(section) {
                switch(section.type) {
                    case 'metrics':
                        return this.renderMetrics(section);
                    case 'charts':
                        return this.renderCharts(section);
                    case 'table':
                        return this.renderTable(section);
                    case 'insights':
                        return this.renderInsights(section);
                    case 'alerts':
                        return this.renderAlerts(section);
                    case 'timeline':
                        return this.renderTimeline(section);
                    case 'highlight':
                        return this.renderHighlight(section);
                    case 'insights-recommendations':
                        return this.renderInsightsRecommendations(section);
                    case 'comparison-grid':
                        return this.renderComparisonGrid(section);
                    case 'highlights':
                        return this.renderHighlights(section);
                    default:
                        return '';
                }
            }

            renderMetrics(section) {
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        ${section.items.map(metric => `
                            <div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition">
                                <div class="text-sm text-gray-500">${metric.label}</div>
                                <div class="text-3xl font-bold mt-2" style="color: ${metric.color || '#1a1a1a'}">${metric.value}</div>
                                <div class="mt-2 text-sm flex items-center gap-1">
                                    <span>${metric.trend || ''}</span>
                                    <span>${metric.change}</span>
                                </div>
                                ${metric.comparison ? `
                                    <div class="metric-comparison mt-3">
                                        <span class="current">${metric.comparison.current}</span>
                                        <span class="previous">${metric.comparison.previous}</span>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            renderComparisonGrid(section) {
                return `
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold mb-4">${section.title}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            ${section.cards.map(card => `
                                <div class="comparison-card">
                                    <h4 class="font-semibold text-gray-800 mb-4">${card.title}</h4>
                                    <div class="space-y-3">
                                        ${card.metrics.map(metric => `
                                            <div>
                                                <div class="text-sm text-gray-500">${metric.label}</div>
                                                <div class="font-semibold">${metric.value}</div>
                                                <div class="trend-indicator ${
                                                    metric.change.includes('+') ? 'trend-up' : 
                                                    metric.change.includes('-') ? 'trend-down' : 
                                                    'trend-neutral'
                                                }">
                                                    <span>${metric.change.includes('+') ? '↑' : metric.change.includes('-') ? '↓' : '→'}</span>
                                                    <span>${metric.change}</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderCharts(section) {
                if (window.NO_CHARTS || !window.chartJsLoaded) {
                    return `
                        <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                            <div class="text-center text-gray-500">
                                <p class="mb-2">📊 Chart visualization is temporarily unavailable</p>
                                <p class="text-sm">Please view the data in the tables for complete information</p>
                            </div>
                        </div>
                    `;
                }
                
                const cols = section.items.length === 1 ? '1' : '2';
                return `
                    <div class="grid grid-cols-1 lg:grid-cols-${cols} gap-6 mb-8">
                        ${section.items.map(chart => `
                            <div class="bg-white rounded-xl p-6 shadow-sm">
                                <h3 class="text-lg font-semibold mb-4">${chart.title}</h3>
                                <div class="chart-container ${chart.type === 'radar' ? 'large' : chart.type === 'scatter' ? 'xl' : ''}">
                                    <canvas id="${chart.id}"></canvas>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            renderTable(section) {
                return `
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-8">
                        <div class="p-6 border-b">
                            <h3 class="text-lg font-semibold">${section.title}</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        ${section.columns.map(col => `
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${col}</th>
                                        `).join('')}
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${section.data.map(row => `
                                        <tr class="hover:bg-gray-50">
                                            ${row.map((cell, i) => `
                                                <td class="px-6 py-4 whitespace-nowrap ${i === row.length - 1 ? 'text-sm font-medium' : ''}">${cell}</td>
                                            `).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            renderInsights(section) {
                return `
                    <div class="bg-white rounded-xl p-6 shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Key Insights & Actions</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${section.items.map(item => `
                                <div class="bg-${item.color}-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-${item.color}-800 mb-2">${item.icon} ${item.title}</h4>
                                    <p class="text-sm text-${item.color}-700">${item.text}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderAlerts(section) {
                return `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h3 class="text-lg font-semibold mb-4 text-red-600">🚨 Critical Issues</h3>
                            <ul class="space-y-3">
                                ${section.items.filter(item => item.type === 'danger').map(item => `
                                    <li class="flex items-start gap-3">
                                        <span class="bg-red-100 text-red-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">!</span>
                                        <div>
                                            <strong>${item.title}</strong>
                                            <p class="text-sm text-gray-600">${item.text}</p>
                                        </div>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="bg-white rounded-xl p-6 shadow-sm">
                            <h3 class="text-lg font-semibold mb-4 text-green-600">✅ Optimization Actions</h3>
                            <ul class="space-y-3">
                                ${section.items.filter(item => item.type === 'success').map((item, i) => `
                                    <li class="flex items-start gap-3">
                                        <span class="bg-green-100 text-green-600 rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold">${i + 1}</span>
                                        <div>
                                            <strong>${item.title}</strong>
                                            <p class="text-sm text-gray-600">${item.text}</p>
                                        </div>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }

            renderTimeline(section) {
                return `
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-6">Action Timeline</h3>
                        ${section.items.map(item => `
                            <div class="border-l-4 border-blue-500 pl-4 mb-6">
                                <div class="text-sm text-gray-500 mb-1">${item.date}</div>
                                <h4 class="font-semibold mb-2">${item.title}</h4>
                                <p class="text-gray-700 mb-2">${item.description}</p>
                                <div class="bg-blue-50 text-blue-700 p-2 rounded text-sm">${item.result}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            renderHighlights(section) {
                return `
                    <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                        <h3 class="text-lg font-semibold mb-4">${section.title}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            ${section.items.map(item => `
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center gap-3 mb-3">
                                        <span class="text-2xl">${item.icon}</span>
                                        <div>
                                            <h4 class="font-semibold">${item.title}</h4>
                                            <p class="text-sm text-gray-600">${item.description}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 text-sm">
                                        ${Object.entries(item.stats).map(([key, value]) => `
                                            <div>
                                                <span class="text-gray-500">${key}:</span>
                                                <span class="font-medium">${value}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderHighlight(section) {
                return `
                    <div class="bg-white rounded-xl p-6 shadow-sm mb-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${section.items.map(item => `
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center gap-3 mb-3">
                                        <span class="text-2xl">${item.icon}</span>
                                        <div>
                                            <h4 class="font-semibold">${item.title}</h4>
                                            <p class="text-sm text-gray-600">${item.description}</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-6 text-sm">
                                        ${Object.entries(item.stats).map(([key, value]) => `
                                            <span>${key}: <strong class="text-green-600">${value}</strong></span>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderInsightsRecommendations(section) {
                return `
                    <div class="insights-section">
                        <h2 class="text-2xl font-bold mb-6">${section.title}</h2>
                        
                        <!-- Insights Section -->
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                                <span class="text-blue-600">💡</span> Key Insights
                            </h3>
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                ${section.insights.map(insight => `
                                    <div class="bg-white rounded-lg p-5 ${insight.priority === 'critical' ? 'border-2 border-red-500' : insight.priority === 'high' ? 'border-2 border-orange-500' : ''}">
                                        <div class="flex items-start gap-3">
                                            <span class="text-2xl">${insight.icon}</span>
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-gray-800 mb-2">${insight.title}</h4>
                                                <p class="text-sm text-gray-600 mb-3">${insight.description}</p>
                                                <div class="bg-gray-50 rounded px-3 py-2 text-xs text-gray-700">
                                                    ${insight.metrics}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Recommendations Section -->
                        <div>
                            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                                <span class="text-green-600">🎯</span> Strategic Recommendations
                            </h3>
                            <div class="space-y-4">
                                ${section.recommendations.map((rec, index) => `
                                    <div class="recommendation-card">
                                        <div class="flex items-start gap-4">
                                            <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-full w-10 h-10 flex items-center justify-center font-bold flex-shrink-0">
                                                ${index + 1}
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-lg mb-2">${rec.title}</h4>
                                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                                    <div>
                                                        <span class="text-gray-500">Action:</span>
                                                        <p class="mt-1">${rec.action}</p>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-500">Expected Impact:</span>
                                                        <p class="mt-1 font-medium text-green-600">${rec.impact}</p>
                                                    </div>
                                                    <div>
                                                        <span class="text-gray-500">Timeline:</span>
                                                        <p class="mt-1 font-medium">${rec.timeline}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            initCharts(sections) {
                if (window.NO_CHARTS || !window.chartJsLoaded || typeof Chart === 'undefined') {
                    console.warn('Charts disabled or Chart.js not available');
                    return;
                }
                
                sections.forEach(section => {
                    if (section.type === 'charts') {
                        section.items.forEach(chartConfig => {
                            // Add additional delay to ensure DOM is ready
                            setTimeout(() => {
                                try {
                                    this.createChart(chartConfig);
                                } catch (error) {
                                    console.error('Error creating chart:', chartConfig.id, error);
                                }
                            }, 100);
                        });
                    }
                });
            }

            createChart(config) {
                const ctx = document.getElementById(config.id);
                if (!ctx) {
                    console.error('Canvas element not found:', config.id);
                    return;
                }

                // Get 2D context
                const context = ctx.getContext('2d');
                if (!context) {
                    console.error('Cannot get 2D context for:', config.id);
                    return;
                }

                // Ensure Chart.js is available
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js is not defined');
                    return;
                }

                try {
                    const chartConfig = {
                        type: config.type,
                        data: config.data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: config.type === 'pie' || config.type === 'doughnut' ? 'bottom' : 'top',
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += context.parsed.y.toLocaleString();
                                            } else if (context.raw !== null) {
                                                label += context.raw.toLocaleString();
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: config.type === 'bar' || config.type === 'line' ? {
                                y: {
                                    beginAtZero: true
                                }
                            } : undefined
                        }
                    };

                    // Special configurations for YoY analysis charts
                    if (config.id === 'weeklyTrendChart') {
                        chartConfig.options.scales = {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Revenue ($)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Orders'
                                },
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        };
                    }

                    if (config.id === 'efficiencyHeatmap') {
                        chartConfig.options.scales = {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Conversion Rate (%)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Average Order Value ($)'
                                }
                            }
                        };
                        chartConfig.options.plugins.tooltip = {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label;
                                    const x = context.parsed.x;
                                    const y = context.parsed.y;
                                    const r = context.raw.r;
                                    return `${label}: CVR ${x}%, AOV $${y}, Revenue Share ${r}%`;
                                }
                            }
                        };
                    }

                    // Special configurations
                    if (config.horizontal) {
                        chartConfig.options.indexAxis = 'y';
                    }

                    if (config.type === 'radar') {
                        chartConfig.options.scales = {
                            r: {
                                beginAtZero: true,
                                max: 100
                            }
                        };
                    }

                    if (config.type === 'doughnut') {
                        chartConfig.options.cutout = '60%';
                    }

                    // Create the chart
                    this.charts[config.id] = new Chart(context, chartConfig);
                } catch (error) {
                    console.error('Failed to create chart:', config.id, error);
                    // Show placeholder for failed chart
                    if (ctx && ctx.parentElement) {
                        ctx.parentElement.innerHTML = `
                            <div class="text-center text-gray-500 py-8">
                                <p>Unable to load chart: ${config.title}</p>
                                <p class="text-sm mt-2">Data available in tables</p>
                            </div>
                        `;
                    }
                }
            }

            refresh() {
                const dashboard = document.getElementById('dashboard');
                dashboard.style.opacity = '0.5';
                
                setTimeout(() => {
                    dashboard.style.opacity = '1';
                    this.render(this.currentTab);
                    this.showNotification('Dashboard refreshed successfully');
                }, 1000);
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // Initialize Dashboard
        function initializeDashboard() {
            try {
                console.log('Initializing dashboard...');
                console.log('Chart.js loaded:', window.chartJsLoaded);
                console.log('Chart.js available:', typeof Chart !== 'undefined');
                
                window.dashboardApp = new DashboardApp();
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                // Show error but allow continuing
                document.getElementById('loadingScreen').innerHTML = `
                    <div class="text-center p-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Dashboard Loading Error</h2>
                        <p class="text-gray-600 mb-6">There was an issue loading some components.</p>
                        <button onclick="location.reload()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition">
                            Reload Page
                        </button>
                    </div>
                `;
            }
        }

        // Start initialization process with better error handling
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded');
            
            // Set a timeout to prevent infinite loading
            const loadTimeout = setTimeout(() => {
                console.warn('Load timeout reached, continuing without charts');
                window.NO_CHARTS = true;
                initializeDashboard();
            }, 10000);
            
            // Check if Chart.js is already loaded
            if (typeof Chart !== 'undefined' && Chart.version) {
                console.log('Chart.js already loaded:', Chart.version);
                window.chartJsLoaded = true;
                clearTimeout(loadTimeout);
                initializeDashboard();
            } else {
                // Start the checking process
                checkChartJS(() => {
                    clearTimeout(loadTimeout);
                    initializeDashboard();
                });
            }
        });

        // Error handler for any uncaught errors
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            if (event.error && event.error.toString().includes('Chart')) {
                console.warn('Chart-related error detected, continuing without charts');
                window.NO_CHARTS = true;
                event.preventDefault(); // Prevent error from blocking execution
            }
        });
    </script>
</body>
</html>